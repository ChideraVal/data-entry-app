{% extends 'base.html' %}

{% block title %}
{% load static %}
<title>Audit Logs</title>
<link rel="stylesheet" href="{% static 'css/audit_logs.css' %}">
{% endblock %}

{% block body %}
<div class="container">
  <header class="header">
    <div class="brand">
      <!-- <div class="logo">AL</div> -->
      <div>
        <h1>Audit Logs</h1>
        <div class="subtitle">Who did what, to what, and when</div>
      </div>
    </div>

    <div class="controls">
      <div>
        <button id="filterUsersBtn" class="btn filter-btn">Filter by users <span id="usersCount" class="count-badge"
            style="display:none">0</span></button>
        <button id="filterActionsBtn" class="btn filter-btn">Filter by actions <span id="actionsCount"
            class="count-badge" style="display:none">0</span></button>
        <button id="filterTargetsBtn" class="btn filter-btn">Filter by target types <span id="targetsCount"
            class="count-badge" style="display:none">0</span></button>
      </div>

      <div>

        <label style="display:flex;gap:6px;align-items:center;">
          <input id="dateFrom" type="date" title="Start date" />
          <span style="color:var(--muted)">â€”</span>
          <input id="dateTo" type="date" title="End date" />
          <!-- <button id="clearDateBtn" class="btn" title="Clear date filter">Clear</button> -->
        </label>

        <div id="dateValidationMsg" style="
          display:none;
          color:#b91c1c;
          font-size:12px;
          margin-top:4px;
        "></div>

      </div>


      <div class="search">
        <input id="searchInput" placeholder="Search username, action, target, target type..." />
        <button id="exportBtn" class="btn btn-primary">Export CSV</button>
        <button id="refreshBtn" class="btn btn-primary">Refresh</button>
      </div>
    </div>
  </header>

  <div id="activeDateBadge" style="
    display:none;
    margin-top:0px;
    /* padding:6px 10px; */
    padding:10px;
    background:#eef2ff;
    color:#3730a3;
    border-radius:6px;
    font-size:13px;
    font-weight:500;
    align-self:flex-start;
  "></div>

  <section class="card" id="mainCard">

    <div id="tableWrap">
      <!-- table inserted here -->
    </div>

    <div class="pagination" id="pager">
      <!-- pagination -->
    </div>
  </section>
</div>

<!-- Details modal -->
<div id="detailsBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal" role="document" aria-labelledby="detailsTitle">
    <h3 id="detailsTitle">Log details</h3>
    <div id="detailsSummary" class="meta-grid" style="margin-bottom:12px">
      <!-- actor/action/target/date -->
    </div>

    <div class="meta-table" id="detailsMeta">
      <!-- metadata rows -->
    </div>

    <label style="display:block;margin-top:10px"><input type="checkbox" id="showRaw"> Show raw JSON</label>
    <div id="rawJsonContainer" style="display:none"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:12px">
      <button class="btn" onclick="closeDetails()">Close</button>
    </div>
  </div>
</div>

<!-- Filter modals -->
<div id="usersBackdrop" class="modal-backdrop">
  <div class="modal filter-modal">
    <h3>Filter by users</h3>
    <div class="filter-list" id="usersList"></div>
    <div class="filter-actions">
      <button class="btn" onclick="closeFilter('users')">Cancel</button>
      <button class="btn btn-primary" onclick="applyFilter('users')">Apply</button>
    </div>
  </div>
</div>

<div id="actionsBackdrop" class="modal-backdrop">
  <div class="modal filter-modal">
    <h3>Filter by actions</h3>
    <div class="filter-list" id="actionsList"></div>
    <div class="filter-actions">
      <button class="btn" onclick="closeFilter('actions')">Cancel</button>
      <button class="btn btn-primary" onclick="applyFilter('actions')">Apply</button>
    </div>
  </div>
</div>

<div id="targetsBackdrop" class="modal-backdrop">
  <div class="modal filter-modal">
    <h3>Filter by target types</h3>
    <div class="filter-list" id="targetsList"></div>
    <div class="filter-actions">
      <button class="btn" onclick="closeFilter('targets')">Cancel</button>
      <button class="btn btn-primary" onclick="applyFilter('targets')">Apply</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast"
  style="position:fixed;right:28px;bottom:28px;background:linear-gradient(90deg,#111827,#0f172a);color:white;padding:12px 16px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.5);transform:translateY(20px);opacity:0;pointer-events:none;transition:opacity .2s,transform .3s"
  role="status" aria-live="polite"></div>
{% endblock %}


{% block scripts %}
<script src="{% static 'scripts/audit_logs.js' %}"></script>
{% endblock %}